# finance-google-sheets-bot

## Как вносить новые категории
Разберем для начала, из чего состоит запись:
(1, "Name", 2)
- сначала идет число (это id текущей категории (подкатегории)), id не должно нигде повторяться и не может быть меньше 0 (создавая новую категорию, просто увеличивайте id)
- дальше идет имя категории, тут все просто
- третий аргумент это id родительской категории

### Основные правила:
1. Не менять первые две записи (Расходы и доходы, у них id родительской категории -1, это говорит о том, что они первые и являются корнем категорий)
2. Не повторять id
3. Нельзя использовать одинаковые имена у категорий (потому что поиск категории идет по имени, если будет два одинаковых - будет работать некорректно)
4. После каждой записи должна быть запятая, а если запись последняя, то точка с запятой
5. Если категория является папкой для других категорий, то надо вставить после строки `INSERT INTO category(id, name, paren_category_id) VALUES`
6. Если категория является конечной, то вставляется после строки `INSERT INTO category(id, name, category_id) VALUES`

### Что делать, когда внес изменения?
1. Надо удалить старый файл c базой данных
2. Создать снова файл
3. Запустить бота (бот на момент изменения категорий должен быть остановлен)

### Пример (мы находимя в папке `src/database/db`):
1. Открываем файл `nvim createdb.sql`
2. Вносим изменения
3. Допустим, я хочу, чтобы у меня в категории расходов была категория "Прочие расходы"
4. У расходов id 1, значить такой же id должен быть у родителя новой категории
5. `(20, "Прочие расходы", 1),`
6. Мы указали id 20, важно, чтобы такого id не было у других категорий и не было категорий с таким же названием (см. Основные правила)
7. У категории "Прочие расходы" будет категория "Поход в кино"
8. `(21, "Поход в кино", 20)`
9. Удаляем старую базу данных `rm database.db`
10. Создаем новую базу данных `touch database.db`
11. Запускаем бота

## Что нужно для запуска бота?
- иметь сервисный аккаунт google и получить доступ к API Google Sheets (creds.json в корне бота) 
- создать бота через @BotFather (потом занести токен в переменные среды)
- занести id таблицы в `src/config.py`

## Инструкция по запуску бота
1. Подключиться по ssh к удаленному серверу
2. Скопировать репозиторий
3. Внести все нужные переменные и файлы (см. Что нужно для запуска бота?)
4. Установить нужные pip зависимости
5. Запустить
